[gd_scene load_steps=3 format=2]

[ext_resource path="res://scn/icon.tscn" type="PackedScene" id=1]

[sub_resource type="GDScript" id=1]
script/source = "extends Panel

export (PackedScene) var Icon

onready var icon_container := $IconContainer
onready var directory      := Directory.new()

func _ready() -> void:
	if directory.open('/') != OK:
		printerr('Can\\'t open directory!')
		return
	update()

func change_directory(path: String) -> int:
	var err := directory.change_dir(path)
	update()
	return err

func open_file(path: String, args := '') -> int:
	print('Opening file: ', path)
	return OK

func update() -> void:
	var file := ''
	
	clear()
	
	directory.list_dir_begin()
	file = directory.get_next()
	while '' != file:
		var icon = Icon.instance()
		
		if directory.current_is_dir():
			icon.is_directory = true
		icon.set_file_path(file)
		icon.connect('opened', self, '_on_icon_opened')
		icon.add_to_group('Icons')
		icon_container.add_child(icon)
		
		file = directory.get_next()

func clear() -> void:
	get_tree().call_group('Icons', 'queue_free')

func _on_icon_opened(icon) -> void:
	var path: String = icon.get_file_path()
	
	print('opening ', path)
	
	if icon.is_directory:
		change_directory(path)
	else:
		open_file(path)
"

[node name="Main" type="Control"]
anchor_right = 1.0
anchor_bottom = 1.0

[node name="Panel" type="Panel" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
script = SubResource( 1 )
Icon = ExtResource( 1 )

[node name="IconContainer" type="GridContainer" parent="Panel"]
anchor_right = 1.0
anchor_bottom = 1.0
