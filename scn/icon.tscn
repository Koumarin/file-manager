[gd_scene load_steps=5 format=2]

[ext_resource path="res://icon.png" type="Texture" id=1]

[sub_resource type="GDScript" id=1]
script/source = "extends VBoxContainer

signal opened(file)
signal selected(file)

var is_directory: bool = false

var _dragging := false
var _selected := false

var _last_mouse_pos: Vector2
var _origin_pos:     Vector2

onready var label     := $Label
onready var selection := $SelectionSprite

func _ready() -> void:
	yield(get_tree(), 'idle_frame')
	_origin_pos = rect_position

func set_file_path(path: String) -> void:
	## If our scene tree is not fully set up we wait
	## until it's ready to set our icon label.
	if not label:
		yield(self, 'ready')
	label.text = path
	set_tooltip(path)

func get_file_path() -> String:
	return label.text

func deselect() -> void:
	_selected         = false
	selection.visible = false

func _gui_input(event: InputEvent) -> void:
	var mouse_pos := get_global_mouse_position()
	if event is InputEventMouseButton:
		if event.doubleclick:
			emit_signal('opened', self)
		elif not _selected and event.is_action_pressed('activate'):
			_last_mouse_pos   = mouse_pos
			_dragging         = true
			_selected         = true
			selection.visible = true
			emit_signal('selected', self)
		elif event.is_action_released('activate'):
			_dragging     = false
			rect_position = _origin_pos
	elif event is InputEventMouseMotion and _dragging:
		rect_position  += mouse_pos - _last_mouse_pos
		_last_mouse_pos = mouse_pos
"

[sub_resource type="OpenSimplexNoise" id=2]
octaves = 1

[sub_resource type="NoiseTexture" id=3]
width = 64
height = 82
bump_strength = 0.0
noise = SubResource( 2 )

[node name="Icon" type="VBoxContainer"]
margin_right = 64.0
margin_bottom = 82.0
script = SubResource( 1 )
__meta__ = {
"_edit_use_anchors_": true
}

[node name="Sprite" type="TextureRect" parent="."]
margin_right = 64.0
margin_bottom = 64.0
mouse_filter = 2
texture = ExtResource( 1 )

[node name="Label" type="Label" parent="."]
margin_top = 68.0
margin_right = 64.0
margin_bottom = 82.0
align = 1
clip_text = true

[node name="SelectionSprite" type="Sprite" parent="."]
visible = false
modulate = Color( 1, 1, 1, 0.501961 )
texture = SubResource( 3 )
centered = false
